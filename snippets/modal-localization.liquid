{% comment %}
双保险 Market / Country 切换
1. 如果 Shopify 支持 localization.available_markets → 列出 Market
2. 否则手动分组 available_countries → 显示市场名
{% endcomment %}

<div id="modal-localization" class="modal fade" tabindex="-1" aria-labelledby="modal-localization-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-localization-label" class="modal-title">
          {{ 'general.localization.title' | t }}
        </h2>
        <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="{{ 'general.accessibility.close' | t }}">
          {% render 'svg-icons', icon: 'x', size: 20 %}
        </button>
      </div>

      <div class="modal-body">
        {% form 'localization' %}
          {% if localization.available_markets and localization.available_markets.size > 1 %}
            {# ✅ 优先显示 Market #}
            <input type="hidden" name="market" value="{{ localization.market.handle }}">
            <ul class="list-group list-group-flush">
              {% for market in localization.available_markets %}
                <button
                  class="list-group-item list-group-item-action {% if market.handle == localization.market.handle %}active{% endif %}"
                  type="submit"
                  name="market"
                  value="{{ market.handle }}">
                  <span>{{ market.name }}</span>
                </button>
              {% endfor %}
            </ul>

          {% elsif localization.available_countries and localization.available_countries.size > 1 %}
            {# ⚡ fallback：手动把国家分组到市场 #}
            <input type="hidden" name="country_code" value="{{ localization.country.iso_code }}">
            <ul class="list-group list-group-flush">

              {%- assign europe = "DE,FR,IT,ES,NL,BE,AT,PL" | split: "," -%}
              {%- assign north_america = "US,CA" | split: "," -%}
              {%- assign asia = "JP,SG,HK" | split: "," -%}

              <button
                class="list-group-item list-group-item-action {% if europe contains localization.country.iso_code %}active{% endif %}"
                type="submit"
                name="country_code"
                value="DE">  {# 默认德国作为欧洲入口 #}
                Europe
              </button>

              <button
                class="list-group-item list-group-item-action {% if north_america contains localization.country.iso_code %}active{% endif %}"
                type="submit"
                name="country_code"
                value="US">
                North America
              </button>

              <button
                class="list-group-item list-group-item-action {% if asia contains localization.country.iso_code %}active{% endif %}"
                type="submit"
                name="country_code"
                value="JP">
                Asia
              </button>
            </ul>
          {% endif %}
        {% endform %}
      </div>
    </div>
  </div>
</div>
